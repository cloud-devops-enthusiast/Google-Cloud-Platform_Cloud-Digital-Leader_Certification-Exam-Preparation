**Google Compute Engine**

For deploying applications you need servers, and for servers you need hardware. In Cloud you rent those virtual servers, which are called *Virtual Machines* (VMs). These VMs are hosted on Google's infrastructure. These VMs are called *Compute Engine*. Here as they come under the Google Cloud's umbrella there is a service that is called as *Google Compute Engine* which is used to provision and manage these VMs. These VMs are called *Compute Engine VMs*.

This Compute Engine service allows the user to manage the whole lifecycle (This lifecyle involves creating a VM, Start or Stop a VM, Restart or Terminate a VM and many more such operations) of the VMs. Here you can plan for autoscaling and Load balancing for multiple VM instances. Compute Engine allows allows the user to attach storage or add network storage solutions for the VMs and have your needed Operating System onto these drives. This Service comes with multiple options like allowing the users to have the networking connectivity and configurations for the VMs, have the security and access control for the VMs, have the monitoring and logging for the VMs and many more such options in their hands.

**Install Apache Web Server on a VM**

Here we will be creating a VM instance and then install Apache Web Server on it. We will be using the Google Cloud Console for this.

1. Go to the Google Cloud Console and select the project you want to work on.

2. Go to the Navigation Menu and select Compute Engine.

3. Click on the Create Instance button.

4. Give a name to your instance.

5. Select the region and zone where you want to deploy your instance.

6. Select the Machine Type. Here we will be using the default Machine Type.

7. Select the Boot Disk. Here we will be using the default Boot Disk.

8. Select the Firewall. Here we will be using the default Firewall.

9. Click on the Create button.

10. Wait for the VM to be created.

11. Click on the SSH button to connect to the VM.

12. As you will SSH, take the root user access by typing the following command:
    ```
    sudo su
    ```

13. Now update the packages by typing the following command:
    ```
    apt update
    ```

14. Now install the Apache Web Server by typing the following command:
    ```
    apt install apache2
    ```

15. Now check for the external IP of the VM from the Google Cloud Console.

16. Now go to the browser and type the following command:
    ```
    http://<External IP of the VM>
    ```
    You will see the default Apache Web Server page.

17. Now we need to put our own HTML page on the Apache Web Server. For this we need to go to the VM and type the following command:
    ```
    cd /var/www/html
    ```

18. You will see an index.html file here. This is the default HTML page of the Apache Web Server. We need to replace this with our own HTML page. For this we need to remove this file by typing the following command:
    ```
    rm index.html
    ```
    This will remove the index.html file.

19. Now we need to create our own HTML file. For this we need to type the following command:
    ```
    vi index.html
    ```

20. Now press the i key to go into the insert mode and type the following HTML code:
    ```
    <html>
        <head>
            <title>My First Web Page</title>
        </head>
        <body>
            <h1>Hello World!</h1>
        </body>
    </html>
    ```
    
21. Now press the Esc key to go into the command mode and type the following command:
    ```
    :wq
    ```
    This will save the file and exit the vi editor.

22. Now go to the browser and type the following command:
    ```
    http://<External IP of the VM>
    ```

**IP addresses in Virtual Machines**

- *Internal IP Addresses:* These IP addresses are used for communication between the VMs or the other resources in the same network. These IP addresses are not reachable from the internet. These are also permanent IP addresses as they are assigned to the VMs when they are created and they are not changed until the VM is deleted.

- *External IP Addresses:* These IP addresses are used for communication outside of the VMs or the other resources in the same network. These IP addresses are reachable from the internet. These are ephemeral IP addresses as they are assigned to the VMs when they are created and they are changed when the VM is stopped and restarted. Now, what's the solution for this?

- *Static IP Addresses:* Permanent External IP addresses can be assigned to the VMs by using the Static IP Addresses. You can change the ephemerality of the External IP addresses to static by reserving a static IP address and then assigning it to the VM. This will make the External IP address permanent and it will not change even if the VM is stopped and restarted.

**BootStrapping**

The process of installing and configuring the software on a VM is called BootStrapping. In this process we can install the OS Patches, Install and Configure the Software, when an instance is created or restarted. This process is also called as *Startup Script*.

**Compute Engine Setup using the Startup Script**

Here we will be creating a VM instance and then install Apache Web Server using the Startup Script.

1. Go to the Google Cloud Console and select the project you want to work on.

2. Go to the Navigation Menu and select Compute Engine.

3. Click on the Create Instance button.

4. Give a name to your instance.

5. Select the region and zone where you want to deploy your instance.

6. Select the Machine Type. Here we will be using the default Machine Type.

7. Select the Boot Disk. Here we will be using the default Boot Disk.

8. Select the Firewall. Here we will be using the default Firewall.

9. Go to the Management, Security, Disks, Networking, Sole Tenancy section and click on the Management tab.

10. Go to the Automation for the Startup Script.

```
#!/bin/bash
apt update
apt -y install apache2
echo "Hello World from $(hostname) $(hostname -I)" > /var/www/html/index.html
```

![Compute Engine Setup using the Startup Script](https://github.com/cloud-devops-enthusiast/Google-Cloud-Platform_Cloud-Digital-Leader_Certification-Exam-Preparation/blob/c37f931170857388d2ec74dcaa26f6b82c81cef3/Images/Screenshot%202023-10-14%20171327.png)

11. Click on the Create button.

12. Wait for the VM to be created.

13. Go to the browser and type the following command:
    ```
    http://<External IP of the VM>
    ```
    You will see the changes which are pushed to that index.html file.

**Compute Engine Setup using the Instance Template**

Instance Template is a combination of the Instance Configuration and the Startup Script. This Instance Template contains the information like the machine type, image, labels, startup script and many more such information. This Instance Template can be used to created VM instances and also to create Managed Instance Groups. One important thing to note here is that the Instance Template cannot be updated once it is created and if you want to update it you can copy the Instance Template and then update it.

Here we will be creating an Instance Template and then create a VM instance using that Instance Template.

1. Go to the Google Cloud Console and select the project you want to work on.

2. Go to the Navigation Menu and select Compute Engine.

3. Click on the Create Instance Template button.

4. Give a name to your Instance Template.

5. Select the region and zone where you want to deploy your Instance Template.

6. Select the Machine Type. Here we will be using the default Machine Type.

7. Select the Boot Disk. Here we will be using the default Boot Disk.

8. Select the Firewall. Here we will be using the default Firewall.

9. Go to the Management, Security, Disks, Networking, Sole Tenancy section and click on the Management tab.

10. Go to the Automation for the Startup Script.

```
#!/bin/bash
apt update
apt -y install apache2
echo "Hello World from $(hostname) $(hostname -I)" > /var/www/html/index.html
```

![Compute Engine Setup using the Instance Template](https://github.com/cloud-devops-enthusiast/Google-Cloud-Platform_Cloud-Digital-Leader_Certification-Exam-Preparation/blob/1993f2667fbdf13c49e356503b13c3e0c4380661/Images/Screenshot%202023-10-14%20215629.png)

11. Click on the Create button.

12. Wait for the Instance Template to be created.

You don't need to pay for the Instance Template. You only need to pay for the VM instances which are created using that Instance Template.

13. As the Instance Template is created, now click on the three dots on the right side of the Instance Template and select Create VM Instance.

14. After this the process is same as we did in the previous section.

**Reducing the Launch Time of the VM Instance with the Custom Image**

In this we will be moving two steps ahead with the Instance Template. Here we will be creating a Custom Image using an Instance Template provisioned Virtual machine and then we will be using that Custom Image to create a VM instance. This will reduce the overall launch time of the VM instance as it takes time to run the custom scripts onto the instances. Here we will be using the Instance Template which we created in the previous section.

Custom images can be created from an instance, a persistent disk, a snapshot, another image or a file in cloud storage. These Custom images can be shared across the projects. Custom Images can be deprecated with the specified replacement image. Custom Images can be deleted when they are no longer needed.

Hardening an image, In this process we create an instance with all the standards and configurations required by the organization. This is the custom image to your corporate security standards. This image can further be used to create the VM instances.

You can create a custom image from the Disks of the running virtual machine instance for which you need to go to the Disks section in the Compute Engine. But there is a twist to this the virtual maachine instance should be in the stopped state. You can't create a custom image from the disks of the running virtual machine instance.

When you update the custom image, you take the copy of the custom image and then update it. This is because the custom image cannot be updated. You can't update the custom image directly.

**Sustained Use Discount**


Automatic discounts for the running VM instances for a significant portion of the month. This discount is applied automatically to the running VM instances. If you have an VM instance running for more than 25% of the month, you get an effective discount of 20% to 30% on the running VM instances depending on every incremental minute as Discount increases with your usage.

This discount is applied to instances created by the Google Kubernetes Engine and the Compute Engine. This discount is not applicable for the certain kind of virtual machines like Preemptible VMs, E2 VMs and A2 VMs. This discount is also not applicable for the VMs which are created by the App Engine Flexible and Dataflow.

**Committed Use Discount**

These kind of discounts work on the basis of the predictable resource needs with the committment of 1 to 3 years. These kind of discounts are based on the machine types and GPUs which are purchased in advance, this can have upto 70% of discount. These discounts are available for the instances created by the Compute Engine and the Google Kubernetes Engine.

You need to remember one thing that you cannot cancel the committments. You can reach out to the Google Cloud Billing Support in case of any issue with the committments.

**Saving Costs with the Preemptible VMs**

Preemptible VMs are the VMs which are available at a lower price or cheaper price on the compute instances. These kind of VMs can be stopped by GCP at any time within 24 hours of time. Instances are triggered with a 30 Second warning before they are stopped, so you can save your work before the instances are stopped. These kind of VMs are suitable for the applications that are fault tolerant and can be restarted easily. These kind of VMs are cost sensitive and can be used for workload that is not immediate. Kind of jobs which are suitable for these kind of VMs are batch processing non immediate jobs.

There are some limitations to these kind of VM's like these kind of VMs are not always available and do not support automatic restarts. No SLA comes with these kind of VMs and cannot be migrated to the regular VMs. These kind of VMs cannot be provisioned with the free credits. You can create a preemptible VM by selecting the checkbox at the time of creating the Compute Engine.

**Spot VMs**

Spot VMs are the Latest version of the Preemptible VMs. These kind of Spot VMs does not have a maximum runtime limit, which is the only one of the key difference between the Spot VMs and the Preemptible VMs. Other features of the Spot VMs are same as the Preemptible VMs. This can be re-claimed at any moment of the time with the 30-Second Notice.

These spot VM's are not always available and has the dynamic price imposed upto 60-91% discount compared to the regular On-Demand VMs. Here also the free tier credits cannot be used to create the Spot VMs. 

**Sole Tenant Nodes**

Sole Tenant Nodes are the physical Servers that can have instances from.

For creating Sole tenat nodes you need to create a Node Group First, which can be created in the Compute Engine. When you go for creating a new Node Group, you need to define the Node Template Properties under which you need to specify the Node Name, Node Region and Zone where you want to deploy your Nodes. After that you need to specify the Node Template Properties, under which you need to name the node template you're creating and the Node Type which you're creating out of it. Here you also need to specify the Key and Value pairs under tyhe Affinity Labels. As you fill the node template properties you will have the option to configure the Autoscaling with setting up the Autoscaling Mode as Off as of now otherwise you can specify the number of the nodes.

You can also have the Sole Tenant Nodes directly in place while creating the VM instance. For this you need to go to the Compute Engine and then click on the Create Instance button. Here you need to specify the Name of the VM instance, Region and Zone where you want to deploy your VM instance. After that you need to specify the Machine Type, Boot Disk, Firewall and the Networking. Here you need to specify the node affinity labels and CPU overcommitment. Here is how you can create the Sole Tenant Nodes.

![Sole Tenant Nodes](https://github.com/cloud-devops-enthusiast/Google-Cloud-Platform_Cloud-Digital-Leader_Certification-Exam-Preparation/blob/da4beec9929512b6e4774284f2f3136c9510d832/Images/Screenshot%202023-10-15%20183349.png)

Use Cases for the Sole Tenant Nodes are:

- Security and Compliance: Your organization or you don't want to have your VMs to be physically seperated from those in other projects.

- High Performace: You want to group your VMs together to maximize the performance of the VMs.

- Licensing Requirements: Which allows you to bring your own licenses to the cloud while useing the per-core or per-processer licenses.

**Custom Machine Types**

